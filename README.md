# golang-cli-tool

[![Build Status](https://travis-ci.org/Manuhmutua/golang-cli-tool.svg?branch=master)](https://travis-ci.org/Manuhmutua/golang-cli-tool)

The question required me to create a CLI that allows the user to list all the resources below:
- IAM users
- EC2 instances
- RDS instances
- S3 buckets
- ECR repos
- ECS clusters

The credentials are to be stored in a file on the userâ€™s machine. The file is a simple text file in the following format:
```sh
AWS_ACCESS_KEY_ID = AKIAXXXXXXX
AWS_SECRET_ACCESS_KEY = XXXXXXXXXXX
AWS_REGION = xx_xxxxx
```

The application should take an input flag corresponding to the location of the credentials file, handle user input errors gracefully and provide a help menu.

## Running the application

The fastest and most convinient way to use this application is by using [docker](https://www.docker.com). You can also clone and build the repository in your local machine if you have AWS cli and Golang installed in your local environment. I'll only explain how to run the application using docker.
Make sure you have docker installed in your machine to continue.

### Building the application 

To use the application you have to build a docker image with the Dockerfile placed in the root directory of the project. 
You can use the Makefile like:
```sh
make build
```
You can also view availble commands in the make file using: (In this case we have only one command.)
```sh
make help
```
Alternertively you can build the image from the root folder of the application by running this command:
```sh
docker build . -t <Name of the Image you want to build>
```

That's it!

### Setting up the application 
 
To use the application, you have to first provide a configuration file as stated in the problem, add it to your application like: 
```sh
docker run -v "<Absolute path of file in your machine>:/home/sample.txt -it test/cli:latest apply -f /home/sample.txt
```
or 
```sh
docker run -v "<Absolute path of file in your machine>:/home/sample.txt -it <name of the image you build> apply -f /home/sample.txt
```
We are doing this to mount the file to our container so that we can be able to run the `apply -f/ --file` command.

For basic access to `gcli` commands, run the following:
```sh
alias gcli='docker run -it test/cli:latest'
```
or 
```sh
alias gcli='docker run -it <name of the image you build>'
```

You can now run commands like:
```sh
gcli help
```

### Using the application 

To list any of the required resources you should use the list command like:
```sh
gcli list ec2
```
 for more details run:
 ```sh
 gcli help list
 ```

 **NB: This application is not tested in a real aws environment**

<section class="compliance-report"><h2>Compliance Report- WIZ</h2><table border="1" cellpadding="5" style="table-layout: fixed;" width="100%"><tr><th>Compliance Status</th><th>Matches</th><th>Details</th></tr><tr><td style="width: 10%; text-align: center;"><p>ðŸŸ  (HIGH &amp; MEDIUM)</p></td><td style="text-align: center;">21</td><td><details><summary>Show</summary><hr><b>Rule: </b>API Gateway methods should require an API key<br/><b>Expected: </b>resource.aws_api_gateway_method[this].api_key_required should be defined<br/><b>File Name: </b>aws/modules/api-gateway-v1/main.tf<br/><b>Line Number: </b>84<br/><b>Resource Name: </b>resource.aws_api_gateway_method[this]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>Application Load Balancer should be integrated with a WAF<br/><b>Expected: </b>'aws_lb[this]' that is not 'internal' should have a 'aws_wafregional_web_acl_association' resource associated<br/><b>File Name: </b>aws/modules/alb/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>aws_lb[this]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>Backup vault access policy should prevent the deletion of backups<br/><b>Expected: </b>aws_backup_vault[this] should contain an Access Policy. The policy should exist and deny the action 'backup:DeleteRecoveryPoint'.<br/><b>File Name: </b>aws/modules/aurora-serverless-v1-postgres/backup.tf<br/><b>Line Number: </b>29<br/><b>Resource Name: </b>aws_backup_vault[this]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>Backup vault access policy should prevent the deletion of backups<br/><b>Expected: </b>aws_backup_vault[this] should contain an Access Policy. The policy should exist and deny the action 'backup:DeleteRecoveryPoint'.<br/><b>File Name: </b>aws/modules/aurora-serverless-v2-mysql/backup.tf<br/><b>Line Number: </b>29<br/><b>Resource Name: </b>aws_backup_vault[this]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>Backup vault access policy should prevent the deletion of backups<br/><b>Expected: </b>aws_backup_vault[this] should contain an Access Policy. The policy should exist and deny the action 'backup:DeleteRecoveryPoint'.<br/><b>File Name: </b>aws/modules/aurora-serverless-v2-postgres/backup.tf<br/><b>Line Number: </b>29<br/><b>Resource Name: </b>aws_backup_vault[this]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>CloudFront distribution should use a custom SSL certificate<br/><b>Expected: </b>'viewer_certificate.cloudfront_default_certificate' should be 'false' or not defined<br/><b>File Name: </b>aws/modules/cloudfront/main.tf<br/><b>Line Number: </b>146<br/><b>Resource Name: </b>aws_cloudfront_distribution[this].viewer_certificate<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>Cognito user pool should not allow anyone to sign themselves up via an app<br/><b>Expected: </b>'aws_cognito_user_pool[this].admin_create_user_config.allow_admin_create_user_only' should be set to 'true'<br/><b>File Name: </b>aws/modules/cognito/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>aws_cognito_user_pool[this]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>Database cluster IAM authentication should be enabled<br/><b>Expected: </b>'aws_rds_cluster[this].iam_database_authentication_enabled' should be defined and 'true'.<br/><b>File Name: </b>aws/modules/aurora-serverless-v1-postgres/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>aws_rds_cluster[this]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>EC2 Security Group should not allow access from all IP addresses<br/><b>Expected: </b>Security Group inbound rule should restrict the IP addresses range<br/><b>File Name: </b>aws/modules/alb/main.tf<br/><b>Line Number: </b>74<br/><b>Resource Name: </b>aws_security_group_rule[ingress]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>EC2 Security Group should not allow outbound traffic from all IP addresses<br/><b>Expected: </b>Security Group outbound rule should restrict the IP addresses range<br/><b>File Name: </b>aws/modules/alb/main.tf<br/><b>Line Number: </b>84<br/><b>Resource Name: </b>aws_security_group_rule[egress]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>EC2 Security Group should not allow outbound traffic from all IP addresses<br/><b>Expected: </b>Security Group outbound rule should restrict the IP addresses range<br/><b>File Name: </b>aws/modules/ecs-service/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>aws_vpc_security_group_ingress_rule[egress]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>EC2 Security Group should not allow outbound traffic from all IP addresses<br/><b>Expected: </b>Security Group outbound rule should restrict the IP addresses range<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>395<br/><b>Resource Name: </b>aws_security_group_rule[vpce_s3_egress]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>EC2 Security Group should not allow outbound traffic from all IP addresses<br/><b>Expected: </b>Security Group outbound rule should restrict the IP addresses range<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>451<br/><b>Resource Name: </b>aws_security_group_rule[vpce_api_egress]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>EC2 Security Group should not allow outbound traffic from all IP addresses<br/><b>Expected: </b>Security Group outbound rule should restrict the IP addresses range<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>507<br/><b>Resource Name: </b>aws_security_group_rule[vpce_secretsmanager_egress]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>EC2 Security Group should restrict inbound traffic to specific ports<br/><b>Expected: </b>Security Group inbound rule should allow a specific port<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>545<br/><b>Resource Name: </b>aws_security_group_rule[ingress_allow_all_for_self]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>EC2 Security Group should restrict outbound traffic to specific ports<br/><b>Expected: </b>Security Group outbound rule should allow a specific port<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>532<br/><b>Resource Name: </b>aws_security_group_rule[egress_allow_all_for_self]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>GitHub Repository Set To Public<br/><b>Expected: </b>Attribute 'private' or Attribute 'visibility' should be defined and not null<br/><b>File Name: </b>github/modules/repository/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>github_repository[this]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>REST API Gateway REST API should use TLS version 1.2 or higher<br/><b>Expected: </b>'security_policy: TLS_1_2' (or undefined) and 'disable_execute_api_endpoint: true'<br/><b>File Name: </b>aws/modules/api-gateway-v1/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>aws_api_gateway_rest_api[this]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>VPC should be protected by a network firewall<br/><b>Expected: </b>aws_vpc[this] has an 'aws_networkfirewall_firewall' associated<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>aws_vpc[this]<br/><b>Severity: </b>MEDIUM<br/><hr/><b>Rule: </b>EC2 Security Group should restrict HTTPS access (TCP:443)<br/><b>Expected: </b>aws_security_group_rule[ingress] should restrict access over port: '443'<br/><b>File Name: </b>aws/modules/alb/main.tf<br/><b>Line Number: </b>74<br/><b>Resource Name: </b>aws_security_group_rule[ingress]<br/><b>Severity: </b>HIGH<br/><hr/><b>Rule: </b>REST API Gateway APIs should be accessible only through private API endpoints<br/><b>Expected: </b>'aws_api_gateway_rest_api.aws_api_gateway_rest_api.types' should be 'PRIVATE'.<br/><b>File Name: </b>aws/modules/api-gateway-v1/main.tf<br/><b>Line Number: </b>11<br/><b>Resource Name: </b>aws_api_gateway_rest_api[this].endpoint_configuration.types[%!s(int=0)]<br/><b>Severity: </b>HIGH<br/><hr/></hr></details></td></tr><tr><td style="width: 10%; text-align: center;"><p>ðŸŸ¡ (LOW &amp; INFORMATIONAL)</p></td><td style="text-align: center;">27</td><td><details><summary>Show</summary><hr><b>Rule: </b>KMS key is scheduled for deletion<br/><b>Expected: </b>KMS key is scheduled for deletion (informational)<br/><b>File Name: </b>aws/modules/kms/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>aws_kms_key[this]<br/><b>Severity: </b>INFORMATIONAL<br/><hr/><b>Rule: </b>KMS key is scheduled for deletion<br/><b>Expected: </b>KMS key is scheduled for deletion (informational)<br/><b>File Name: </b>aws/modules/route53-zone/main.tf<br/><b>Line Number: </b>60<br/><b>Resource Name: </b>aws_kms_key[this]<br/><b>Severity: </b>INFORMATIONAL<br/><hr/><b>Rule: </b>API Gateway stages access logging should be enabled<br/><b>Expected: </b>aws_api_gateway_deployment[this].stage_description should be set<br/><b>File Name: </b>aws/modules/api-gateway-v1/main.tf<br/><b>Line Number: </b>21<br/><b>Resource Name: </b>aws_api_gateway_deployment[this]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>EC2 Security Group outbound rules should not allow all protocols<br/><b>Expected: </b>Security Group outbound rule should not allow all protocols<br/><b>File Name: </b>aws/modules/alb/main.tf<br/><b>Line Number: </b>88<br/><b>Resource Name: </b>aws_security_group_rule[egress].protocol<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>EC2 Security Group outbound rules should not allow all protocols<br/><b>Expected: </b>Security Group outbound rule should not allow all protocols<br/><b>File Name: </b>aws/modules/ecs-service/main.tf<br/><b>Line Number: </b>301<br/><b>Resource Name: </b>aws_vpc_security_group_egress_rule[egress].ip_protocol<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>EC2 Security Group outbound rules should not allow all protocols<br/><b>Expected: </b>Security Group outbound rule should not allow all protocols<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>404<br/><b>Resource Name: </b>aws_security_group_rule[vpce_s3_egress].protocol<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>EC2 Security Group outbound rules should not allow all protocols<br/><b>Expected: </b>Security Group outbound rule should not allow all protocols<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>460<br/><b>Resource Name: </b>aws_security_group_rule[vpce_api_egress].protocol<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>EC2 Security Group outbound rules should not allow all protocols<br/><b>Expected: </b>Security Group outbound rule should not allow all protocols<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>516<br/><b>Resource Name: </b>aws_security_group_rule[vpce_secretsmanager_egress].protocol<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>EC2 Security Group outbound rules should not allow all protocols<br/><b>Expected: </b>Security Group outbound rule should not allow all protocols<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>541<br/><b>Resource Name: </b>aws_security_group_rule[egress_allow_all_for_self].protocol<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>IAM User should not have any policies attached<br/><b>Expected: </b>'user' is redundant<br/><b>File Name: </b>aws/modules/location/iam.tf<br/><b>Line Number: </b>26<br/><b>Resource Name: </b>aws_iam_user_policy[{{assume_role}}].user<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>Lambda function X-Ray tracing should be enabled<br/><b>Expected: </b>aws_lambda_function[this].tracing_config.mode should be set to 'Active'<br/><b>File Name: </b>aws/modules/lambda/main.tf<br/><b>Line Number: </b>65<br/><b>Resource Name: </b>aws_lambda_function[this].tracing_config.mode<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>REST API Gateway content encoding should be enabled<br/><b>Expected: </b>Attribute 'minimum_compression_size' should be set and have a value greater than -1 and smaller than 10485760<br/><b>File Name: </b>aws/modules/api-gateway-v1/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>aws_api_gateway_rest_api[this]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>REST API Gateway deployment should be associated with a usage plan<br/><b>Expected: </b>aws_api_gateway_deployment[this] should have a 'aws_api_gateway_usage_plan' resource associated<br/><b>File Name: </b>aws/modules/api-gateway-v1/main.tf<br/><b>Line Number: </b>21<br/><b>Resource Name: </b>aws_api_gateway_deployment[this]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>REST API Gateway stage should be associated with a usage plan<br/><b>Expected: </b>'aws_api_gateway_stage[this]' should have a 'aws_api_gateway_usage_plan' resource associated<br/><b>File Name: </b>aws/modules/api-gateway-v1/main.tf<br/><b>Line Number: </b>40<br/><b>Resource Name: </b>aws_api_gateway_stage[this]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>REST API Gateway stages CloudWatch execution logging should be enabled<br/><b>Expected: </b>'aws_cloudwatch_log_group' should be defined and use the correct naming convention<br/><b>File Name: </b>aws/modules/api-gateway-v1/main.tf<br/><b>Line Number: </b>40<br/><b>Resource Name: </b>aws_api_gateway_stage[this]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>Resource Policy should contain a Principal<br/><b>Expected: </b>'Principal' should be defined<br/><b>File Name: </b>aws/modules/ecs-task-definition/iam.tf<br/><b>Line Number: </b>11<br/><b>Resource Name: </b>aws_iam_role[task_role].policy<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>Resource Policy should contain a Principal<br/><b>Expected: </b>'Principal' should be defined<br/><b>File Name: </b>aws/modules/ecs-task-definition/iam.tf<br/><b>Line Number: </b>46<br/><b>Resource Name: </b>aws_iam_role[task_execution_role].policy<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>Resource should be protected by Shield Advanced<br/><b>Expected: </b>aws_lb has shield advanced associated<br/><b>File Name: </b>aws/modules/alb/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>aws_lb[this]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>Resource should be protected by Shield Advanced<br/><b>Expected: </b>aws_cloudfront_distribution has shield advanced associated<br/><b>File Name: </b>aws/modules/cloudfront/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>aws_cloudfront_distribution[this]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>Resource should be protected by Shield Advanced<br/><b>Expected: </b>aws_route53_zone has shield advanced associated<br/><b>File Name: </b>aws/modules/route53-zone/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>aws_route53_zone[this]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>Resource should be protected by Shield Advanced<br/><b>Expected: </b>aws_eip has shield advanced associated<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>297<br/><b>Resource Name: </b>aws_eip[nat]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>S3 Bucket logging should be enabled<br/><b>Expected: </b>'logging' is defined and not null<br/><b>File Name: </b>aws/modules/s3-bucket/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>aws_s3_bucket[this]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>Unused Security Group should be deleted<br/><b>Expected: </b>'aws_security_group[vpce_s3_interface]' should be used<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>370<br/><b>Resource Name: </b>aws_security_group[vpce_s3_interface]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>Unused Security Group should be deleted<br/><b>Expected: </b>'aws_security_group[vpce_api_interface]' should be used<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>426<br/><b>Resource Name: </b>aws_security_group[vpce_api_interface]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>Unused Security Group should be deleted<br/><b>Expected: </b>'aws_security_group[vpce_secretsmanager_interface]' should be used<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>482<br/><b>Resource Name: </b>aws_security_group[vpce_secretsmanager_interface]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>Unused Security Group should be deleted<br/><b>Expected: </b>'aws_security_group[allow_all_for_self]' should be used<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>520<br/><b>Resource Name: </b>aws_security_group[allow_all_for_self]<br/><b>Severity: </b>LOW<br/><hr/><b>Rule: </b>VPC Flow Logs should be enabled in all applicable AWS regions<br/><b>Expected: </b>aws_vpc[this] should be the same as Flow Logs VPC id<br/><b>File Name: </b>aws/modules/vpc/main.tf<br/><b>Line Number: </b>1<br/><b>Resource Name: </b>aws_vpc[this]<br/><b>Severity: </b>LOW<br/><hr/></hr></details></td></tr></table></section>
